name: ðŸš€ Build Yemen Market

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Setup Java 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: Fix Gradle Configuration
      run: |
        # 1. Ø§Ø³ØªØ®Ø¯Ù… Gradle 8.4 (Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹)
        echo "distributionUrl=https\://services.gradle.org/distributions/gradle-8.4-bin.zip" > gradle/wrapper/gradle-wrapper.properties
        
        # 2. Ø£Ù†Ø´Ø¦ settings.gradle.kts Ø§Ù„ØµØ­ÙŠØ­
        cat > settings.gradle.kts << 'EOF'
        pluginManagement {
            repositories {
                google()
                mavenCentral()
                gradlePluginPortal()
            }
        }
        
        rootProject.name = "YemenMarket"
        include(":app")
        EOF
        
        # 3. Ø¥ØµÙ„Ø§Ø­ gradlew
        chmod +x gradlew 2>/dev/null || true
        
    - name: Create Android Project Structure
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        mkdir -p app/src/main/java/com/yemenmarket
        mkdir -p app/src/main/res/layout
        mkdir -p app/src/main/res/values
        mkdir -p app/src/main/res/menu
        
    - name: Create Project Files
      run: |
        # 1. AndroidManifest.xml
        cat > app/src/main/AndroidManifest.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android"
            package="com.yemenmarket">
            
            <uses-permission android:name="android.permission.INTERNET" />
            
            <application
                android:allowBackup="true"
                android:icon="@mipmap/ic_launcher"
                android:label="Ø³ÙˆÙ‚ Ø§Ù„ÙŠÙ…Ù†"
                android:theme="@style/Theme.AppCompat.Light">
                
                <activity android:name=".MainActivity"
                    android:exported="true">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                </activity>
            </application>
        </manifest>
        EOF
        
        # 2. MainActivity.kt (Ù…Ø¨Ø³Ø·)
        cat > app/src/main/java/com/yemenmarket/MainActivity.kt << 'EOF'
        package com.yemenmarket
        
        import androidx.appcompat.app.AppCompatActivity
        import android.os.Bundle
        
        class MainActivity : AppCompatActivity() {
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContentView(R.layout.activity_main)
            }
        }
        EOF
        
        # 3. build.gradle.kts Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
        cat > app/build.gradle.kts << 'EOF'
        plugins {
            id("com.android.application")
            id("org.jetbrains.kotlin.android")
        }
        
        android {
            namespace = "com.yemenmarket"
            compileSdk = 34
            
            defaultConfig {
                applicationId = "com.yemenmarket"
                minSdk = 21
                targetSdk = 34
                versionCode = 1
                versionName = "1.0.0"
            }
            
            buildTypes {
                getByName("debug") {
                    isMinifyEnabled = false
                }
            }
            
            compileOptions {
                sourceCompatibility = JavaVersion.VERSION_1_8
                targetCompatibility = JavaVersion.VERSION_1_8
            }
        }
        
        dependencies {
            implementation("androidx.core:core-ktx:1.12.0")
            implementation("androidx.appcompat:appcompat:1.6.1")
            implementation("com.google.android.material:material:1.11.0")
        }
        EOF
        
        # 4. Ù…Ù„Ù layout Ø¨Ø³ÙŠØ·
        cat > app/src/main/res/layout/activity_main.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:gravity="center"
            android:orientation="vertical">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ðŸš€ Ø³ÙˆÙ‚ Ø§Ù„ÙŠÙ…Ù†"
                android:textSize="28sp"
                android:textStyle="bold"
                android:layout_marginBottom="20dp"/>
                
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!"
                android:textSize="18sp"/>
                
        </LinearLayout>
        EOF
        
    - name: Build APK
      run: |
        ./gradlew :app:assembleDebug --no-daemon --stacktrace
          
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: yemen-market-apk
        path: app/build/outputs/apk/debug/*.apk
