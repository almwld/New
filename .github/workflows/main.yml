name: ğŸš€ Build Yemen Market

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
      uses: actions/checkout@v4
      
    - name: â˜• ØªØ«Ø¨ÙŠØª Java 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: ğŸ› ï¸ Ø¥ØµÙ„Ø§Ø­ Ù…Ù„ÙØ§Øª Gradle
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Gradle Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙÙ‚ÙˆØ¯Ø©
        if [ ! -f "settings.gradle.kts" ]; then
          echo 'rootProject.name = "YemenMarket"' > settings.gradle.kts
          echo 'include(":app")' >> settings.gradle.kts
        fi
        
        # Ø¥ØµÙ„Ø§Ø­ line endings
        if [ -f "gradlew" ]; then
          sed -i 's/\r$//' gradlew
          chmod +x gradlew
        fi
        
    - name: ğŸ“± Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø³ÙˆÙ‚
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        mkdir -p app/src/main/java/com/yemenmarket
        mkdir -p app/src/main/res/layout
        mkdir -p app/src/main/res/values
        mkdir -p app/src/main/res/drawable
        
    - name: ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      run: |
        # 1. build.gradle.kts Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
        cat > app/build.gradle.kts << 'EOF'
        plugins {
            id("com.android.application")
            id("org.jetbrains.kotlin.android")
        }
        
        android {
            namespace = "com.yemenmarket"
            compileSdk = 34
            
            defaultConfig {
                applicationId = "com.yemenmarket"
                minSdk = 21
                targetSdk = 34
                versionCode = 1
                versionName = "1.0.0"
            }
            
            buildTypes {
                getByName("debug") {
                    isMinifyEnabled = false
                }
                getByName("release") {
                    isMinifyEnabled = false
                }
            }
            
            compileOptions {
                sourceCompatibility = JavaVersion.VERSION_1_8
                targetCompatibility = JavaVersion.VERSION_1_8
            }
        }
        
        dependencies {
            implementation("androidx.core:core-ktx:1.12.0")
            implementation("androidx.appcompat:appcompat:1.6.1")
            implementation("com.google.android.material:material:1.11.0")
            implementation("androidx.constraintlayout:constraintlayout:2.1.4")
        }
        EOF
        
        # 2. AndroidManifest.xml
        cat > app/src/main/AndroidManifest.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android"
            package="com.yemenmarket">
            
            <uses-permission android:name="android.permission.INTERNET" />
            
            <application
                android:name=".YemenMarketApp"
                android:allowBackup="true"
                android:icon="@drawable/ic_launcher"
                android:label="@string/app_name"
                android:theme="@style/Theme.YemenMarket"
                android:supportsRtl="true">
                
                <activity
                    android:name=".MainActivity"
                    android:exported="true"
                    android:windowSoftInputMode="adjustResize">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                </activity>
                
                <activity android:name=".ProductsActivity" />
                <activity android:name=".CartActivity" />
                <activity android:name=".ProfileActivity" />
                
            </application>
        </manifest>
        EOF
        
        # 3. Ù…Ù„Ù Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø·
        cat > app/src/main/res/values/colors.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <color name="primary">#2E7D32</color>
            <color name="primary_dark">#1B5E20</color>
            <color name="accent">#FF9800</color>
            <color name="white">#FFFFFF</color>
            <color name="black">#000000</color>
            <color name="gray">#9E9E9E</color>
            <color name="background">#F5F5F5</color>
            <color name="text_primary">#212121</color>
            <color name="text_secondary">#757575</color>
            <color name="success">#4CAF50</color>
            <color name="error">#F44336</color>
            <color name="warning">#FFC107</color>
        </resources>
        EOF
        
        cat > app/src/main/res/values/styles.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <style name="Theme.YemenMarket" parent="Theme.MaterialComponents.Light.NoActionBar">
                <item name="colorPrimary">@color/primary</item>
                <item name="colorPrimaryDark">@color/primary_dark</item>
                <item name="colorAccent">@color/accent</item>
                <item name="android:windowBackground">@color/background</item>
                <item name="android:statusBarColor">@color/primary_dark</item>
            </style>
            
            <style name="AppTitle" parent="TextAppearance.MaterialComponents.Headline5">
                <item name="android:textColor">@color/primary</item>
                <item name="android:textStyle">bold</item>
            </style>
            
            <style name="ProductCard" parent="CardView">
                <item name="cardCornerRadius">12dp</item>
                <item name="cardElevation">4dp</item>
            </style>
        </resources>
        EOF
        
        cat > app/src/main/res/values/strings.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <string name="app_name">Ø³ÙˆÙ‚ Ø§Ù„ÙŠÙ…Ù†</string>
            <string name="welcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„ÙŠÙ…Ù†</string>
            <string name="products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</string>
            <string name="categories">Ø§Ù„ÙØ¦Ø§Øª</string>
            <string name="cart">Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</string>
            <string name="profile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</string>
            <string name="search">Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...</string>
            <string name="add_to_cart">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</string>
            <string name="buy_now">Ø§Ø´ØªØ±ÙŠ Ø§Ù„Ø¢Ù†</string>
            <string name="price">Ø§Ù„Ø³Ø¹Ø±</string>
            <string name="ry">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</string>
            <string name="view_all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</string>
            <string name="featured_products">Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø©</string>
            <string name="recent_products">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</string>
            <string name="login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</string>
            <string name="register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</string>
        </resources>
        EOF
        
        # 4. Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        cat > app/src/main/res/layout/activity_main.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <androidx.constraintlayout.widget.ConstraintLayout 
            xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:background="@color/background">
            
            <com.google.android.material.appbar.MaterialToolbar
                android:id="@+id/toolbar"
                android:layout_width="match_parent"
                android:layout_height="?attr/actionBarSize"
                android:background="@color/primary"
                app:title="@string/app_name"
                app:titleTextColor="@color/white"
                app:layout_constraintTop_toTopOf="parent" />
            
            <com.google.android.material.bottomnavigation.BottomNavigationView
                android:id="@+id/bottom_navigation"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:background="@color/white"
                app:menu="@menu/bottom_nav_menu"
                app:layout_constraintBottom_toBottomOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintEnd_toEndOf="parent" />
            
            <androidx.viewpager2.widget.ViewPager2
                android:id="@+id/view_pager"
                android:layout_width="match_parent"
                android:layout_height="0dp"
                app:layout_constraintTop_toBottomOf="@id/toolbar"
                app:layout_constraintBottom_toTopOf="@id/bottom_navigation" />
                
        </androidx.constraintlayout.widget.ConstraintLayout>
        EOF
        
        # 5. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ
        mkdir -p app/src/main/res/menu
        cat > app/src/main/res/menu/bottom_nav_menu.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <menu xmlns:android="http://schemas.android.com/apk/res/android">
            <item
                android:id="@+id/nav_home"
                android:icon="@drawable/ic_home"
                android:title="@string/app_name" />
            <item
                android:id="@+id/nav_products"
                android:icon="@drawable/ic_products"
                android:title="@string/products" />
            <item
                android:id="@+id/nav_cart"
                android:icon="@drawable/ic_cart"
                android:title="@string/cart" />
            <item
                android:id="@+id/nav_profile"
                android:icon="@drawable/ic_profile"
                android:title="@string/profile" />
        </menu>
        EOF
        
        # 6. MainActivity.kt
        cat > app/src/main/java/com/yemenmarket/MainActivity.kt << 'EOF'
        package com.yemenmarket
        
        import android.os.Bundle
        import androidx.appcompat.app.AppCompatActivity
        import androidx.viewpager2.widget.ViewPager2
        import com.google.android.material.bottomnavigation.BottomNavigationView
        
        class MainActivity : AppCompatActivity() {
            
            private lateinit var viewPager: ViewPager2
            private lateinit var bottomNav: BottomNavigationView
            
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContentView(R.layout.activity_main)
                
                viewPager = findViewById(R.id.view_pager)
                bottomNav = findViewById(R.id.bottom_navigation)
                
                setupViewPager()
                setupBottomNavigation()
            }
            
            private fun setupViewPager() {
                // Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ViewPager Adapter Ù‡Ù†Ø§
            }
            
            private fun setupBottomNavigation() {
                bottomNav.setOnItemSelectedListener { item ->
                    when (item.itemId) {
                        R.id.nav_home -> {
                            viewPager.currentItem = 0
                            true
                        }
                        R.id.nav_products -> {
                            viewPager.currentItem = 1
                            true
                        }
                        R.id.nav_cart -> {
                            viewPager.currentItem = 2
                            true
                        }
                        R.id.nav_profile -> {
                            viewPager.currentItem = 3
                            true
                        }
                        else -> false
                    }
                }
            }
        }
        EOF
        
        # 7. YemenMarketApp.kt
        cat > app/src/main/java/com/yemenmarket/YemenMarketApp.kt << 'EOF'
        package com.yemenmarket
        
        import android.app.Application
        
        class YemenMarketApp : Application() {
            override fun onCreate() {
                super.onCreate()
                // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Firebase Ø£Ùˆ Ø£ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø®Ø±Ù‰ Ù‡Ù†Ø§
            }
        }
        EOF
        
    - name: ğŸ”¨ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      run: |
        # ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Gradle Wrapper
        if [ ! -f "gradlew" ]; then
          echo '#!/bin/bash' > gradlew
          echo 'gradle "$@"' >> gradlew
          chmod +x gradlew
        fi
        
        # Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ APK
        ./gradlew :app:assembleDebug \
          --no-daemon \
          --stacktrace \
          --warning-mode=all
        
    - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ù€ APK Ø§Ù„Ù†Ø§ØªØ¬
      uses: actions/upload-artifact@v4
      with:
        name: yemen-market-apk
        path: app/build/outputs/apk/debug/*.apk
        
    - name: ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡
      if: always()
      run: |
        echo "âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ Yemen Market Ø¨Ù†Ø¬Ø§Ø­!"
        echo "ğŸ“± Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: 1.0.0"
        echo "ğŸ“¦ API Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: Android 14 (API 34)"
        echo "ğŸ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: Android 5.0 (API 21)"
        echo "ğŸ“ Ø­Ø¬Ù… Ø§Ù„Ù€ APK: $(ls -lh app/build/outputs/apk/debug/*.apk 2>/dev/null | awk '{print $5}' || echo 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...')"
